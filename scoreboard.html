<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QCMania 2 Scoreboard</title>
<style>
    body {
        margin: 0;
        font-family: 'Arial', sans-serif;
        color: white;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: background 0.5s;
        text-align: center;
    }

    .scoreboard {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 90%;
        max-width: 1200px;
    }

    .top-team {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 50px;
    }

    .top-team img {
        max-width: 300px;
        height: auto;
        margin-bottom: 10px;
    }

    .top-team .team-name {
        font-size: clamp(2rem, 5vw, 3rem);
        font-weight: bold;
        text-shadow: 0 0 10px rgba(0,0,0,0.7);
    }

    .top-team .score {
        font-size: clamp(3rem, 8vw, 5rem);
        font-weight: bold;
        text-shadow: 0 0 15px rgba(0,0,0,0.7);
    }

    .other-teams {
        display: flex;
        justify-content: space-around;
        width: 100%;
    }

    .other-teams .team {
        display: flex;
        flex-direction: column;
        align-items: center;
        font-size: clamp(1rem, 3vw, 1.5rem);
        text-shadow: 0 0 10px rgba(0,0,0,0.7);
    }
</style>
</head>
<body>

<div class="scoreboard" id="scoreboard">
    <!-- Teams will be populated here -->
</div>

<script>
const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTp9jiAXHLSXP4d983ipXv0fKZheaaJLSt4OYWgLookJisCeWVuMwZhXKi7VFpkx-SsSVhNyyL95xO3/pub?gid=1637211824&single=true&output=csv';

const teamImages = {
    'Hogwarts': 'https://raw.githubusercontent.com/lghtfury/QCMania/main/Images/Hogwarts.png',
    'Beauxbaton': 'https://raw.githubusercontent.com/lghtfury/QCMania/main/Images/Beauxbaton.png',
    'Durmstrang': 'https://raw.githubusercontent.com/lghtfury/QCMania/main/Images/Durmstrang.png',
    'Ilvermorny': 'https://raw.githubusercontent.com/lghtfury/QCMania/main/Images/Ilvermorny.png'
};

const teamColors = {
    'Hogwarts': 'linear-gradient(135deg, #FF0000, #FFD700, #0000FF, #008000)', // red, yellow, blue, green
    'Beauxbaton': '#ADD8E6',   // light airy blue
    'Durmstrang': 'linear-gradient(135deg, #FF4500, #8B0000)', // fiery gradient
    'Ilvermorny': 'linear-gradient(135deg, #C0C0C0, #355E3B)' // silver & hunter green
};

const fallbackImage = 'https://raw.githubusercontent.com/lghtfury/QCMania/main/Images/default.png';

// Fetch CSV and parse
async function fetchCSV() {
    try {
        const response = await fetch(csvUrl);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.text();
        return parseCSV(data);
    } catch (error) {
        console.error('Failed to fetch CSV:', error);
        return [];
    }
}

// Parse CSV into array of objects
function parseCSV(data) {
    const lines = data.trim().split('\n');
    const headers = lines.shift().split(',').map(h => h.trim());
    return lines.map(line => {
        const values = line.split(',').map(v => v.trim());
        return Object.fromEntries(headers.map((h, i) => [h, values[i]]));
    });
}

// Render the scoreboard
function renderScoreboard(teams) {
    const container = document.getElementById('scoreboard');
    container.innerHTML = '';

    if (!teams.length) return;

    // Sort descending by score
    teams.sort((a, b) => (parseInt(b.Score) || 0) - (parseInt(a.Score) || 0));

    const topTeam = teams[0];
    document.body.style.background = teamColors[topTeam.Team] || '#222';

    // Top team
    const topDiv = document.createElement('div');
    topDiv.className = 'top-team';
    topDiv.innerHTML = `
        <img src="${teamImages[topTeam.Team] || fallbackImage}" alt="${topTeam.Team}" onerror="this.src='${fallbackImage}'">
        <div class="team-name">${topTeam.Team}</div>
        <div class="score">${topTeam.Score}</div>
    `;
    container.appendChild(topDiv);

    // Fade-in effect
    topDiv.style.opacity = 0;
    setTimeout(() => topDiv.style.transition = 'opacity 0.5s', 0);
    setTimeout(() => topDiv.style.opacity = 1, 50);

    // Other teams
    const otherDiv = document.createElement('div');
    otherDiv.className = 'other-teams';
    teams.slice(1).forEach(team => {
        const div = document.createElement('div');
        div.className = 'team';
        div.innerHTML = `
            <div class="team-name">${team.Team}</div>
            <div class="score">${team.Score}</div>
        `;
        otherDiv.appendChild(div);
    });
    container.appendChild(otherDiv);
}

// Update scoreboard every 10 seconds
async function updateScoreboard() {
    const teams = await fetchCSV();
    renderScoreboard(teams);
}

async function loopUpdateScoreboard(interval = 10000) {
    while (true) {
        await updateScoreboard();
        await new Promise(r => setTimeout(r, interval));
    }
}

// Start live updates
loopUpdateScoreboard();
</script>

</body>
</html>
